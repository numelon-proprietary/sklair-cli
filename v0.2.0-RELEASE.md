# Sklair 0.2.0 ðŸ‘¾

Sklair 0.2.0 focuses on build extensibility, sandboxing, and a more reliable development workflow.

This release includes **pre- and post-build hooks** with a **sandboxed Lua environment** (for scripting), and major improvements to `sklair serve` along with a new `sklair clean` command.

## What's new? ðŸ¸

### Pre- and post-build hooks

Projects can now define Lua scripts that run:

- **before** Sklair builds a site, and
- **after** Sklair finished building

These hooks are intended for things like generating data files, transforming assets, or preparing or post-processing build output.

Hooks run in a **sandboxed Lua environment** with a controlled filesystem API, so they can do useful work without having unrestricted access to your system.

> [!NOTE]
> Hooks run in a deliberately restricted Lua sandbox. There is no coroutine support because hooks are intended to be simple, deterministic, and strictly sequential.
>
> The goal of hooks is data preparation and build-time transformation - not background tasks or schedulers, etc. To support that, Sklair provides only what is actually needed, such as filesystem access, JSON, and a few other things.
>
> If you believe coroutines are genuinely required for a real-world build workflow (and not just for convenience), feel free to [open an issue](https://github.com/numelon-oss/sklair-cli/issues) and make the case. I am happy to revisit this design if it proves justified.

### Sandboxed filesystem for hooks

### Functions in `fs.*`

- `fs.read(path)` - reads an entire file and returns `contents (string)` on success, or `nil, errMsg (string)` on failure.
- `fs.write(path)` - writes an entire file and returns `true` on success, or `nil, errMsg (string)` on failure.
- `fs.scandir(path)` - scan an entire directory and returns a `table` containing entries with fields `name (string)` and `isDir (boolean)` on success, or `nil, errMsg (string)` on failure.

Lua hooks use Sklair's filesystem API instead of direct OS access, where paths are scoped by prefix:

| Prefix       | Purpose                                   |
|--------------|-------------------------------------------|
| `project:`   | Read-only access to source files          |
| `cache:`     | Persistent cache between builds and hooks |
| `temp:`      | Temporary workspace                       |
| `generated:` | Artefacts produced by pre-build hooks     |
| `built:`     | Final site output (post-build only)       |

### `sklair clean`

A new, simple command to remove:

- cached data
- temporary files
- generated artefacts

### Improved `sklair serve`

The development server now behaves properly in projects:

- filesystem watching is debounced
- build state (`.sklair/`) is excluded from watching, to prevent self-triggered rebuild loops
- The implementation of this command is no longer a "quick solution", but rather properly refined

### Internal build system improvements

- clearer timing output when in debug verbosity
- ***much* faster static file copying**, thanks to switching from `os.ReadFile` (a full in-memory load) to streaming with `io.Copy`, which avoids buffering entire files in RAM.

## What's next?

0.2.0 changes Sklair from something that compiles HTML and components, into something that can now run sandboxed logic before and after building, and has a reliable live development server. Essentially a build system.

Coming next will be component nesting with circular dependency detection, dynamic resource hints, full Lua block support, and finally distribution of Sklair via package managers like homebrew, winget, and maybe apt.
